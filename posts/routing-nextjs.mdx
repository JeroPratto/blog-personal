---
title: 'Routing en Next.js 13 con middleware: Rutas privadas y p칰blicas'
subtitle: 'Aprende a proteger y gestionar el acceso a las rutas en tu aplicaci칩n de Next.js 13 utilizando Middleware y cookies'
description: 'En este tutorial, aprender치s a implementar enrutamiento de p치ginas privadas y p칰blicas en Next.js utilizando cookies y un middleware. Utilizaremos js-cookie y configuraremos el middleware para redirigir a los usuarios seg칰n su estado de autenticaci칩n.'
date: '2023-07-10'
urlImg: 'routing-nextjs-middleware-privadas-publicas.jpg'
---

<small>2023-07-10</small>

# Routing en Next.js 13 con middleware: Rutas privadas y p칰blicas

En este post vas a aprender c칩mo implementar el enrutamiento de p치ginas privadas y p칰blicas en Next.js utilizando cookies y un middleware.

## Descargas e instalaci칩n

```bash
npm install js-cookie
npm i --save-dev @types/js-cookie
```

## Disposic칩n de archivos y carpetas

Un aspecto importante a tener en cuenta es que el middleware debe estar en el mismo nivel que la carpeta "app". Si est치s utilizando la carpeta "src", deber치 estar dentro de "src" y al mismo nivel que "app".

- middleware.ts
- 游늭app
  - page.tsx
  - 游늭admin
    - page.tsx
  - 游늭Contexts
    - authContext.tsx
  - 游늭login
    - page.tsx

## Configuraci칩n del context

El context en s칤 no requiere ninguna configuraci칩n especial para el enrutamiento, pero lo incluir칠 para que puedas ver c칩mo lo implement칠. Cabe mencionar que no estoy devolviendo ni utilizando la cookie ni el estado en este ejemplo, pero podr칤as hacerlo seg칰n tus necesidades.

```tsx:Contexts/authContext.tsx
'use client'

import { ReactNode, createContext, useMemo } from 'react'
import Cookies from 'js-cookie'

export type AuthContextProviderProps = {
	children: ReactNode
}

export const AuthContext = createContext({
	Login: (authTokens: string) => {},
	Logout: () => {},
})

export default function AuthContextProvider({
	children,
}: AuthContextProviderProps) {

  const Login = (authTokens: string) => {
			Cookies.set('authTokens', JSON.stringify(authTokens))
	}

  const Logout = () => {
		Cookies.remove('authTokens')
	}

  const value = useMemo(
		() => ({
			Login,
			Logout,
		}),
		[Login, Logout],
	)

  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>
}
```

## Middleware

El middleware se encarga de interceptar las solicitudes de acceso a una p치gina y determinar c칩mo procesarlas. En este caso, si intentamos acceder a "/admin" sin un token de autenticaci칩n, seremos redirigidos a "/login", y si tenemos un token y tratamos de acceder a "/login", seremos redirigidos a "/admin".

Puedes encontrar m치s informaci칩n en la <a target="_blank" href='https://nextjs.org/docs/app/building-your-application/routing/middleware'>documentaci칩n oficial</a>.

```tsx:middleware.ts
import { NextResponse } from 'next/server'
import type { NextRequest } from 'next/server'

export function middleware(request: NextRequest) {
	const authTokens = request.cookies.get('authTokens')?.value

	if (request.nextUrl.pathname.startsWith('/admin') && !authTokens) {
		const response = NextResponse.redirect(new URL('/login', request.url))
		response.cookies.delete('authTokens')
		return response
	}
	if (authTokens && request.nextUrl.pathname.startsWith('/login')) {
		const response = NextResponse.redirect(new URL('/admin', request.url))
		return response
	}
}
// Estas son las rutas sobre la que actua el middleware
export const config = {
	matcher: ['/login', '/admin'],
}
```

## Uso

En este ejemplo, veremos un componente que contiene un formulario para simular un inicio de sesi칩n.

```tsx:login/page.tsx
'use client'
import { useRouter } from 'next/navigation'
import { FormEvent, useContext } from 'react'
import { AuthContext } from '../Contexts/authContext'

export default function Login() {
  const { Login } = useContext(AuthContext)
	const router = useRouter()

  const handleSubmit = async (event: FormEvent<HTMLFormElement>) => {
    event.preventDefault()
    const input = event.currentTarget.elements.namedItem('name',) as HTMLInputElement
    const name = input.value
    // Aca nos deberian dar el token.
    const response = await ConectBackend(name)
    const token = await response.json()
    Login(token)
    router.refresh()
    router.push('/admin')
  }

  return (
    <div>
      <form onSubmit={handleSubmit}>
        <input name='name'>
        <button>Login</button>
      </form>
    </div>
  )
}
```

En este ejemplo falta agregar manejo de errores para el caso de credenciales incorrectas o cuando el backend no responda, pero esto es solo una demostraci칩n.

En resumen, ahora tendr치s rutas privadas y p칰blicas en tu aplicaci칩n de Next.js 13.
